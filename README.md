# YesTicket WP Plugin

Wordpress Plugin to display Events, Shows, Performances, Workshops, Festivals and Audience Feedback (Testimonials) from the ["YesTicket" Online Ticketing Service](https://www.yesticket.org/).

[![codecov](https://codecov.io/gh/H3rby7/yesticket-custom/branch/main/graph/badge.svg?token=HJCBUM2CST)](https://codecov.io/gh/H3rby7/yesticket-custom)

# Installing in Wordpress

1. In your Wordpress go to `Plugins > Install`.
2. Select the plugin ZIP archive.
3. Activate plugin
4. Configure the necessary settings on the plugin page
    * You need an account at https://www.yesticket.org/.
5. Use the shortcodes. For help visit the plugin settings page.

## Customizing

You can find the client-side CSS [here](./yesticket/front.css). Use your own CSS to overwrite the necessary styles.

# Developing

[DEV-Setup Credits to nezhar](https://github.com/nezhar/wordpress-docker-compose)

Setup will run on [http://127.0.0.1](http://127.0.0.1).

## Run DEV ENV

First you need to adjust a few settings:

    cp env.example .env

And adjust the new `.env` file to your configuration.

### Start

    docker-compose run --rm wpcli install-wp.sh

## Stop DEV ENV

    docker-compose down --volumes

## Deployment / Shipping

Update [this file](README.md) and also update [the changelog](CHANGELOG.md)!

### Automated

Requires docker. Windows users: Make sure the `bin/*.sh` files have LF file endings.

    docker-compose -f docker-compose.zip.yml run --rm zipper

### Manual

Zip the files inside the `yesticket` folder. It should contain the following files and folders:

    |_admin.css
    |_front.css
    |_front.js
    |_yesticket_api.php
    |_yesticket_helpers.php
    |_yesticket_plugin_page.php
    |_yesticket.php
    |_admin/*
        |_(whole folder)
    |_img/*
        |_(whole folder)
    |_languages/*
        |_(whole folder)
    |_shortcodes/*
        |_(whole folder)
## Manual Testing

1. On Settings page trigger all functions once
    * Save
    * Clear Cache
2. On Shortcodes page go through all TABs
3. On created content page check if all shortcodes render correctly
    * remember to 'display details', where possible
4. Switch to a different image in [docker-compose](docker-compose.yml) and repeat the testing process.

## Automated Test-Setup

TODO: 
- [ ] write and use automated tests.
- [ ] run automated tests for different PHP/WP versions

[Credits to chriszarate](https://github.com/chriszarate/docker-compose-wordpress)

For a list of common assertions [see this](https://make.wordpress.org/core/handbook/testing/automated-testing/writing-phpunit-tests/#using-assertions).

### Running automated Tests

Simple All-In-One:

    docker-compose -f docker-compose.phpunit.yml up --build wordpress_phpunit

If encountering any errors, attempt the same cmd again.

If it still fails try:

    docker-compose -f docker-compose.phpunit.yml up -d
    docker-compose -f docker-compose.phpunit.yml run --rm wordpress_phpunit phpunit --debug [...args]

### Stop automated Test Container

This clears the whole testing setup.

    docker-compose -f docker-compose.phpunit.yml down --volumes

# Translations

Followed the [Official Wordpress Guide](https://developer.wordpress.org/plugins/internationalization/how-to-internationalize-your-plugin/).

If you want to add a translation you can use the ['Loco' Plugin to help translating locally](https://wordpress.org/plugins/loco-translate/).

***Note that some text is generated by the YesTicket API***


# Useful Commands

## Check php --ini settings

Check for php ini boolean params. E.G. for 'allow_url_fopen':

    docker-compose exec -ti wp php -r "var_dump(\filter_var(\ini_get('allow_url_fopen'), \FILTER_VALIDATE_BOOLEAN));"
